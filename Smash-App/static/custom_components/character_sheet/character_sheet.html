<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/iron-media-query/iron-media-query.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../../bower_components/iron-collapse/iron-collapse.html">
<link rel="import" href="../../bower_components/paper-card/paper-card.html">

<link rel="import" href="../character_select/character_select.html">
<link rel="import" href="../input_builder/input_builder.html">
<link rel="import" href="../frame_scrubber/frame_scrubber.html">

<dom-module id="character-sheet">
    <template>
        <style>
            paper-card {
                margin: 4px;
                width: 100%;
            }
            .move_card:hover, .card_header:hover {
                cursor: pointer;
            }
            .move_card {
                width: 125px;
            }
            .move_header {
                @apply --paper-font-headline;
                font-size: 16px;
                margin: 8px;
            }
            .card_header {
                @apply --paper-font-headline;
            }
            .collapse_icon {
                float: right;
                padding-top: 0px;
            }
        </style>
         <paper-card image="{{ character.character_select_image }}">
            <div class="card-content">
                <div class="card_header" id="character_moves" on-tap="moves_collapse_tapped">Moves
                    <template is="dom-if" if="{{ moves_opened }}"><paper-icon-button class="collapse_icon" icon="smash:chevron_up" hidden="{{ opened }}"></paper-icon-button></template>
                    <template is="dom-if" if="{{ !moves_opened }}"><paper-icon-button class="collapse_icon" icon="smash:chevron_down" hidden="{{ !opened }}"></paper-icon-button></template>
                </div>
                <iron-collapse id="moves">
                    <div class="collapse-content">
                        <div class="category_header">Active</div>
                        <template is="dom-repeat" items="{{ character.moves }}" as="active_move">
                            <template is="dom-if" if="{{ active_move.active }}">
	                            <paper-card class="move_card" image="{{ active_move.animation }}" elevation="2" on-tap="move_tapped">
	                                <div class="move_header">{{ active_move.name }}</div>
	                            </paper-card>
                            </template>
                        </template>
                        <div class="category_header">Passive</div>
                        <template is="dom-repeat" items="{{ character.moves }}" as="passive_move">
                            <template is="dom-if" if="{{ !passive_move.active }}">
	                            <paper-card class="move_card" image="{{ passive_move.animation }}" elevation="2" on-tap="move_tapped">
	                                <div class="move_header">{{ passive_move.name }}</div>
	                            </paper-card>
	                        </template>
                        </template>
                    </div>
                </iron-collapse>
            </div>
            <div class="card-content">
                <div class="card_header" id="specific_tech" on-tap="tech_collapse_tapped">Specific Tech
                    <template is="dom-if" if="{{ tech_opened }}"><paper-icon-button class="collapse_icon" icon="smash:chevron_up" hidden="{{ opened }}"></paper-icon-button></template>
                    <template is="dom-if" if="{{ !tech_opened }}"><paper-icon-button class="collapse_icon" icon="smash:chevron_down" hidden="{{ !opened }}"></paper-icon-button></template>
                </div>
                <iron-collapse id="tech">
                    <template is="dom-repeat" items="{{ character.tech }}" as="tech">
                        <div class="category_header">Waveshine</div>
                        <input-builder inputs="{{ tech }}"></input-builder>
                    </template>
                </iron-collapse>
            </div>
           <div class="card-content">
                <div class="card_header">Scrubber</div>
                <frame-scrubber></frame-scrubber>
            </div>
        </paper-card>
    </template>
    <script>
        Polymer({
            is: 'character-sheet',
            
            properties: {
            	character: {
            		type: Object,
            		value: {}
            	},
            	moves_opened: {
            		type: Boolean,
            		value: false,
            	},
            	tech_opened: {
            		type: Boolean,
            		value: false
            	}
            },
    
            ready: function() {
            },

            moves_collapse_tapped: function(event) {
            	this.get_character_moves_data();
            	this.$.moves.toggle();
            	this.moves_opened = this.$.moves.opened;
            },

            tech_collapse_tapped: function() {
                this.get_character_tech_data();
                this.$.tech.toggle();
                this.tech_opened = this.$.tech.opened;
            },

            get_character_moves_data: function() {
            	//send request to load moves here
            	var loaded_moves = [{name: 'Up Smash',
            		                 animation: '../../images/moves/fox/up_smash.gif',
            		                 active: true},
            		                 {name: 'Roll',
            		                 animation: '../../images/moves/fox/roll.gif',
            		                 active: false}];
            	this.set('character.moves', loaded_moves)
            },

            get_character_tech_data: function() {
            	//send request to load tech here
            	console.log('get char tech data')
            },

            get_active_moves: function() {
            	var active_moves = [];
            	for(var i=0; i < this.character.moves.length; i++) {
            		if(this.character.moves[i].active) {
            			active_moves.push(this.character.moves[i]);
            		}
            	}
            	return active_moves;
            },

            get_passive_moves: function() {
                var passive_moves = [];
                for(var i=0; i < this.character.moves.length; i++) {
                    if(!this.character.moves[i].active) {
                        passive_moves.push(this.character.moves[i]);
                    }
                }
                return passive_moves;
            },

            move_tapped: function(event) {
            	var move = event.model.active_move || event.model.passive_move;
            }
        });
    </script>
</dom-module>