<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">

<link rel="import" href="../../images/gcc_buttons/a.png">
<link rel="import" href="../../images/gcc_buttons/b.png">
<link rel="import" href="../../images/gcc_buttons/r.png">
<link rel="import" href="../../images/gcc_buttons/l.png">
<link rel="import" href="../../images/gcc_buttons/control_down_right.png">
<link rel="import" href="../../images/gcc_buttons/control_down_left.png">
<link rel="import" href="../../images/gcc_buttons/y.png">
<link rel="import" href="../../images/gcc_buttons/x.png">
<link rel="import" href="../../images/gcc_buttons/plus.png">

<dom-module id="input-builder">
    <template>
        <style is="custom-style" include="iron-flex iron-flex-alignment">
            img {
                width:40px;
                height: 40px;
                padding: 4px;
            }
            .plus {
                width: 20px;
                height: 20px;
                margin: auto 0px;
                padding: 0px;
            }
            .comma {
                margin: auto 0px;
                font-size: 200%;
            }
        </style>

        <div class="layout horizontal wrap">
            <template is="dom-repeat" items="{{ formatted_inputs }}" as="input">
                <template is="dom-if" if="{{ is_array(input.input) }}">
                    <template is="dom-repeat" items="{{ input.input }}" as="combined_input">
                        <img src="{{ get_combined_source(combined_input) }}">
                        <template is="dom-if" if="{{ !is_last_array_item(input.input,combined_input) }}">
                            <img class="plus" src=" ../../images/gcc_buttons/plus.png">
                        </template>
                    </template>
                </template>
               <template is="dom-if" if="{{ !is_array(input.input) }}">
                    <img src=" {{ input.source }}">
                </template>
                <div class="comma" hidden="{{ is_last_comma_item(formatted_inputs, input.input) }}">,</div>
            </template>
            
        </div>
    </template>
    <script>
        Polymer({
            is: 'input-builder',
            
            properties: {
                inputs: {
                	type: Array,
                	value: []
                },
                formatted_inputs: {
                	type: Array,
                	value: []
                }
            },

            ready: function() {
            	this.format_inputs();
            },

            is_array: function(obj) {
            	return Array.isArray(obj);
            },

            is_last_array_item: function(arr, element) {
            	if(arr[arr.length - 1] == element) {
            		return true;
            	}
            	else {
            		return false;
            	}
            },

            is_last_comma_item: function(arr, element) {
                if(arr[arr.length - 1].input == element) {
                	return true;
                }
                else {
                	return false;
                }
            },

            format_inputs: function() {
            	var key = Object.keys(this.inputs)[0]
            	for(var i=0; i < this.inputs[key].length; i++) {
            		if(this.inputs[key][i].indexOf(' + ') !== -1) {
            			this.inputs[key][i] = this.inputs[key][i].split(' + ');
            		}
            		if(this.is_array(this.inputs[key][i])) {
            			this.push('formatted_inputs', {input: this.inputs[key][i]});
            		}
            		else {
            			this.push('formatted_inputs', {input: this.inputs[key][i],
                            source: '../../images/gcc_buttons/' + this.inputs[key][i] + '.png'});
            		}
            		
            	}
            },

            get_combined_source: function(obj) {
            	return '../../images/gcc_buttons/' + obj + '.png';
            }
        });
    </script>
</dom-module>